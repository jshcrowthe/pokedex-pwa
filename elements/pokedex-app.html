<link rel='import' href='../bower_components/polymer/polymer.html'>
<link rel='import' href='../bower_components/iron-pages/iron-pages.html'>
<link rel='import' href='../bower_components/app-route/app-route.html'>
<link rel='import' href='../bower_components/app-route/app-location.html'>

<!--Eagerly Load List because it is going to be rendered the most-->
<link rel='import' href='./pokemon-list.html'>

<dom-module id="pokedex-app">
  <template>
    <app-location route="{{route}}"></app-location>
    <app-route
      route="{{route}}"
      pattern="/:page"
      data="{{data}}"
      tail="{{subroute}}">
    </app-route>

    <iron-pages class='fill' selected='[[data.page]]' attr-for-selected='data-route' fallback-selection='__home'>
      <pokemon-list data-route='__home'></pokemon-list>
      <pokemon-viewer data-route='pokemon'></pokemon-viewer>
    </iron-pages>
  </template>
  
  <script>
  (function() {
    var routeResourceMap = {
      pokemon: './pokemon-viewer.html'
    };

    var resourceFetchArr = [];

    Polymer({
      is: 'pokedex-app',
      observers: [
        '_pageChanged(data.page)'
      ],
      _pageChanged: function(page) {
        if (!routeResourceMap[page]) return;
        var resource = routeResourceMap[page];
        if (~resourceFetchArr.indexOf(resource)) return;

        var link = document.createElement('link');
        link.rel = 'import';
        link.async = true;
        link.href = this.resolveUrl(resource);
        document.head.appendChild(link);
        resourceFetchArr.push(resource);
      }
    });
  })();
  </script>
</dom-module>
